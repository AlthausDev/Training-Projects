@page "/Todo"
<PageTitle>ToDo List!</PageTitle>

@inject HttpClient Http
@inject IJSRuntime JSRuntime
@using BlazorWebPage.Shared
@using Syncfusion.Blazor.Buttons
@using Syncfusion.Blazor.Popups
@using System.Diagnostics

<div id="formulario">
    <SfDialog Target="#formulario" Width="75%" Height="90%" ShowCloseIcon="true" @bind-Visible="@isVisible" AllowPrerender="true" IsModal="true">
        <DialogTemplates>
            <Header>Nuevo Formulario</Header>
            <Content>
                <div id="formDiv">
                    <label id="formLabel">Nombre</label>
                    <SfTextBox ID="formTextBox" Placeholder='Nombre' FloatLabelType='FloatLabelType.Auto'
                               @bind-Value="@nuevaTarea.Nombre" ValueChange="@ValueChangeHandler" ShowClearButton=true>
                    </SfTextBox>
                </div>

                <div id="formDiv">
                    <label id="formLabel">Descripción</label>
                    <SfTextBox ID="formTextBox" class="multiline" Placeholder='Descripcion' FloatLabelType='FloatLabelType.Auto'
                               @bind-Value="@nuevaTarea.Descripcion" ValueChange="@ValueChangeHandler" Multiline=true>
                    </SfTextBox>
                </div>

                <div id="formDiv">
                    <SfCheckBox @bind-Checked="@nuevaTarea.Finalizado" Label="Finalizado"></SfCheckBox>
                </div>

                <div id="FormButtons">
                    <button class="btn btn-success" @onclick="addTarea" disabled="@IsDisabled">Aceptar</button>
                    @*<button class="btn btn-success" @onclick="ProcesarBtn" disabled="@IsDisabled">Aceptar</button>*@
                    <button class="btn btn-danger" @onclick="closePopup">Cancelar</button>
                </div>
            </Content>
        </DialogTemplates>
    </SfDialog>
</div>


<div id="formularioEdit">
    <SfDialog Target="#formulario" Width="75%" Height="90%" ShowCloseIcon="true" @bind-Visible="@isVisibleEdit" AllowPrerender="true" IsModal="true">
        <DialogTemplates>
            <Header>Nuevo Formulario</Header>
            <Content>
                <div id="formDiv">
                    <label id="formLabel">Nombre</label>
                    <SfTextBox ID="formTextBox" Placeholder='Nombre' FloatLabelType='FloatLabelType.Auto'
                               @bind-Value="@nuevaTarea.Nombre" ValueChange="@ValueChangeHandler" ShowClearButton=true>
                    </SfTextBox>
                </div>

                <div id="formDiv">
                    <label id="formLabel">Descripción</label>
                    <SfTextBox ID="formTextBox" class="multiline" Placeholder='Descripcion' FloatLabelType='FloatLabelType.Auto'
                               @bind-Value="@nuevaTarea.Descripcion" ValueChange="@ValueChangeHandler" Multiline=true>
                    </SfTextBox>
                </div>

                <div id="formDiv">
                    <SfCheckBox @bind-Checked="@nuevaTarea.Finalizado" Label="Finalizado"></SfCheckBox>
                </div>

                <div id="FormButtons">
                    <button class="btn btn-success" @onclick="editTarea" disabled="@IsDisabled">Aceptar</button>
                    <button class="btn btn-danger" @onclick="closePopup">Cancelar</button>
                </div>
            </Content>
        </DialogTemplates>
    </SfDialog>
</div>

<div id="topButtons">
    <div>
        <button class="btn btn-warning" @onclick="@mostrarPopup">Nueva Tarea</button>
        @*<button class="btn btn-warning" @onclick="(() => mostrarPopup(Accion.Crear))">Nueva Tarea</button>*@
    </div>
    <div>
        <button class="btn btn-danger" @onclick="@Delete" disabled="@IsDisabledEdit">Borrar</button>
    </div>
    <div>
        <button class="btn btn-success" @onclick="@mostrarPopupEdit" disabled="@IsDisabledEdit">Editar</button>
        @*<button class="btn btn-success" @onclick="(() => mostrarPopup(Accion.Editar))" disabled="@IsDisabledEdit">Editar</button>*@
    </div>
</div>

<table class="table">
    <thead>
        <tr>
            <th>Nombre</th>
            <th>Descripcion</th>
            <th>Finalizado</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var tarea in tareas)
        {
            <tr class="@GetRowClass(tarea)" id="fila" @onclick="(() => selectTarea(tarea))">
                <td>@tarea.Nombre</td>
                <td>@tarea.Descripcion</td>
                <td>@(tarea.Finalizado ? Finalizado.Si : Finalizado.No)</td>
            </tr>
        }
    </tbody>
</table>

<section id="bottom"></section>

<div id="scrollBtnContainer">
    <button id="scrollBtnDown" onclick="bottomFuction()" title="Scroll to Bottom">
        <i class="oi oi-chevron-bottom"></i>
    </button>
</div>
<div id="scrollBtnContainertop">
    <button id="scrollBtn" onclick="topFunction()" title="Scroll to Top">
        <i class="oi oi-chevron-top"></i>
    </button>
</div>

<script>
    let mybutton = document.getElementById("scrollBtn");
    let mybuttonTop = document.getElementById("scrollBtnDown");

    window.onscroll = function () { scrollFunction() };

    function scrollFunction() {
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            mybutton.style.display = "block";
        } else {
            mybutton.style.display = "none";
        }
    }

    window.addEventListener('scroll', (e) => {
        const body = document.body;
        const parent = body.parentElement;
        const pixelsFromBottom = body.scrollHeight - parent.clientHeight - 50;

        if (parent.scrollTop < pixelsFromBottom) {
            mybuttonTop.style.display = "block";
        } else {
            mybuttonTop.style.display = "none";
        }
    });

    function topFunction() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    }

    function bottomFuction() {
        document.getElementById('bottom').scrollIntoView({ behavior: 'smooth' });
    }
</script>

<style>

    #scrollBtn, #scrollBtnDown {
        position: fixed;
        right: 2%;
        z-index: 999;
        border: 1px solid white;
        background: linear-gradient(145deg, rgba(7,54,141,1) 0%, rgba(42,33,121,1) 33%, rgba(81,9,99,1) 70%, rgba(81,9,99,1) 100%);
        color: white;
        cursor: pointer;
        padding: 10px 15px 10px 15px;
        border-radius: 12px;
        font-size: 18px;
        box-shadow: 1px 1px 20px 4px rgba(107,11,131,1);
    }

    #scrollBtn {
        display: none;
        bottom: 5%;
    }

    #scrollBtnDown {
        display: block;
        top: 7%;
    }

        #scrollBtn:hover, #scrollBtnDown:hover {
            background: linear-gradient(290deg, rgba(9,72,190,1) 0%, rgba(55,43,162,1) 33%, rgba(107,11,131,1) 70%, rgba(107,11,131,1) 100%);
        }


    body {
        background: linear-gradient(160deg, rgba(27,58,117,0.7624299719887955) 0%, rgba(80,21,94,0.7344187675070029) 47%, rgba(239,222,246,1) 100%);
    }

  /*   #topButtons {       
        display: inline-flex;
        position: fixed;
        text-align: center;
        width: 100%;
    } */

    #topButtons {
        background: #fff;                           
        z-index: 99;
        box-shadow: 0px 0px 6px 0px rgba(0, 0, 0, 0.5);
        position: fixed;        
        text-align: center;
        width: 90%;
  }

        #topButtons div {
            display: inline-flex;
            text-align: center;
            margin: 2%;
            box-shadow: 1px 1px 22px 4px rgba(66,52,66,0.69);
            border-radius: 8px;
        }

        #topButtons button {
            border-radius: 8px;
            border: 1px solid white;
        }

    #formDiv {
        display: flex;
        flex-direction: row;
        margin: 2% 5% 5%;
    }

        #formDiv label {
            display: inline-block;
            flex: 1;
            flex-basis: 15%;
            align-items: flex-start;
            font-size: 14px;
        }

    #formLabel {
        margin-top: 28px;
    }

    #FormButtons {
        margin: 5%;
        text-align: right;
    }

        #FormButtons button {
            box-shadow: 1px 1px 22px 4px rgba(66,52,66,0.69);
            margin-right: 2%;
            border-radius: 8px;
            border: 1px solid white;
        }

    .btn {
        width: 165px;
    }

    .e-float-input.e-control-wrapper textarea:not(:valid), .e-float-input.e-control-wrapper textarea:valid,
    .e-input-group textarea:not(:valid), .e-input-group textarea:valid {
        min-height: 250px;
    }

    #finalizadoCheckBox {
        margin-right: 15px;
    }

    .table, th, td {
        border: 1px solid black;
    }

        .table th {
            background-color: #E0E0E0;
        }

    tr:not(.selected-row) {
        cursor: pointer;
        background-color: white;
    }

    tr:hover:not(.selected-row) {
        background-color: lightcyan;
    }

    .selected-row {
        background-color: #9ed9e0;
    }
</style>

